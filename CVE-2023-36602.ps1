# Проверка уязвимости CVE-2023-##### и обновления KB5031356
function Check-YazvAndUpdate {
    $yazvKB = "CVE-2023-36602"
    $updateKB = "KB5031356"
    $updateURL = "https://catalog.s.download.windowsupdate.com/d/msdownload/update/software/secu/2023/10/windows10.0-kb5031356-x64_65d5bbc39ccb461472d9854f1a370fe018b79fcc.msu"

    # Проверка наличия обновления KB5031356
    $updateInstalled = Get-HotFix | Where-Object {$_.HotFixID -eq $updateKB}

    if ($updateInstalled) {
        Write-Host "Обновление $updateKB уже установлено."
    } else {
        Write-Host "Компьютер подвержен уязвимости $yazvKB."
        Write-Host "Необходимо установить обновление $updateKB."

        # Предложение скачать и установить обновление
        $installChoice = Read-Host "Хотите скачать и установить обновление? (Y/N)"

        if ($installChoice -eq 'Y' -or $installChoice -eq 'y') {
            Write-Host "Скачивание обновления $updateKB..."
            $updatePath = "C:\Temp\$updateKB.msu"  # Путь для сохранения файла

            # Загрузка обновления
            Invoke-WebRequest -Uri $updateURL -OutFile $updatePath

            # Установка обновления
            Write-Host "Установка обновления $updateKB..."
            Start-Process -FilePath "wusa.exe" -ArgumentList $updatePath -Wait
        } else {
            Write-Host "Обновление не установлено. Компьютер остается уязвимым."
        }
    }
}
# Вызов функции для проверки уязвимости и установки обновления
Check-YazvAndUpdate
